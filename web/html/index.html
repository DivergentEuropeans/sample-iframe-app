

<!-- 
  This program and the accompanying materials are
  made available under the terms of the Eclipse Public License v2.0 which accompanies
  this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html
  
  SPDX-License-Identifier: EPL-2.0
  
  Copyright Contributors to the Zowe Project.
-->

<!DOCTYPE html>
<!-- This HTML could really contain anything, as long as the iframe App is pointed to some page, it will be contained within an iframe App window on the Desktop.
In this case however, we are loading a simple JS file, ../js/main.js which has some awareness of Desktop globals for interaction -->
<html>
  <head>
    <title>Plug-in API Example</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/iframe.css">
    <script>
      if(exports){
        var ZoweZLUX_tempExports = exports;
      }
      var exports = {"__esModule": true};
    </script>
    <script type="text/javascript" src="../../../../../lib/org.zowe.zlux.logger/0.9.0/logger.js"></script>
    <script type="text/javascript" src="../../../org.zowe.zlux.bootstrap/web/iframe-adapter.js"></script>
    <script type="text/javascript" src="../js/main.js"></script>
    <!-- UNIT TEST -->
    <script>
      let notifications = [];
      function handleMessageAdded(message){
        notifications.unshift(message);
        console.log(`iFrame instance ${instanceId} ADD HANDLER: `, notifications,);
      }

      function handleMessageRemoved(id) {
        notifications.splice(notifications.findIndex(x => x.id === id), 1);
        console.log(`iFrame instance ${instanceId} REMOVE HANDLER: `, notifications);
      }

      function assertParam(param, testNum){
        if(param === false){
          console.warn('ASSERT FAILED: ', testNum)
        } else {
          console.log(`Assert passed: `, testNum);
        }
      }

      function assertEqual(testValue, expectedValue, testNum){
        if(testValue === expectedValue){
          console.log('Assert equal passed: ', testNum)
        } else {
          console.warn('ASSERT EQUAL FAILED: ', testNum, 'Test value: ' + testValue + ' | Expected value: ' + expectedValue);
        }
      }

      function testZoweZLUXExists(){
        assertParam(ZoweZLUX !== undefined, 2);
      }
      
      async function testNotificationManager(){
        ZoweZLUX.notificationManager.addMessageHandler(this).then(res => {
          ZoweZLUX.notificationManager.createNotification('legalize ranch', 'bird up', 1, 't.e.s.t').then(async function(testNotification) {
            await ZoweZLUX.notificationManager.notify(testNotification)
            await ZoweZLUX.notificationManager.notify(testNotification)
            await ZoweZLUX.notificationManager.notify(testNotification)
            await ZoweZLUX.notificationManager.notify(testNotification)
            assertParam(notifications.length === 4, 0);
            let notificationIDs = notifications.map(elem => { return elem.id});
            for(let i = 0; i < notificationIDs.length; i++){
              let oldLen = notifications.length;
              await ZoweZLUX.notificationManager.dismissNotification(notificationIDs[i]);
              assertParam(notifications.length === oldLen - 1, 1);
            }
          })
        })
      }

      async function testGlobalization(){
        let curLang = await ZoweZLUX.globalization.getLanguage();
        await ZoweZLUX.globalization.setLanguage('en');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'en', 3);
        });
        await ZoweZLUX.globalization.setLanguage('zh');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'zh', 4);
        });
        await ZoweZLUX.globalization.setLanguage('fr');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'fr', 5);
        });
        await ZoweZLUX.globalization.setLanguage('ja');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'ja', 6);
        });
        await ZoweZLUX.globalization.setLanguage('ru');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'ru', 7);
        });
        await ZoweZLUX.globalization.setLanguage('de');
        ZoweZLUX.globalization.getLanguage().then((res) => {
          assertEqual(res, 'de', 8);
        });
        await ZoweZLUX.globalization.setLanguage(curLang);
      }

      function contextMenuAction0(){
        console.log('Performed context menu action 0')
      }

      function contextMenuAction1(){
        console.log('Performed context menu action 1')
      }

      async function testWindowActions(){
        await windowActions.minimize();
        await windowActions.maximize();
        await windowActions.restore();
        await windowActions.setTitle('bird up');
        await windowActions.setPosition({top: 0, left: 0, width: 600, height: 400})
        await windowActions.spawnContextMenu(0, 0, [
          {
            text: 'test0',
            action: contextMenuAction0
          },
          {
            text: 'test1',
            action: contextMenuAction1
          }
        ])
        await viewportEvents.registerCloseHandler(() => {
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              console.log('this is a test close handler with a 3s delay before closing to simulate an expensive function');
              resolve();
            }, 3000)
          })
        })
      }

      async function testLogger(){
        let myLogger = ZoweZLUX.logger.makeComponentLogger('yeezy');
        myLogger.info('pluginDef from iframe: ', pluginDef);
        myLogger.severe('launch metadata: ', launchMetadata);
        myLogger.warn('i saidAAaaaAAAAaAAAAAAaAAAaaaAAHHHHHHHHHHHHHHHHHhhHHHHHHHHHhhhHHHHHHHHHHHHHH', testGlobalization);
        myLogger.critical('critical log');
        myLogger.debug('debug log');
        myLogger.trace('trace log');
        let sublogger = myLogger.makeSublogger('yandhi');
        sublogger.info('info log');
        sublogger.severe('severe log');
        sublogger.warn('warn log');
        sublogger.critical('critical log');
        sublogger.debug('debug log');
        sublogger.trace('trace log');
      }

      function test(){
        //testZoweZLUXExists();
        //testNotificationManager();
        //testGlobalization();
        //testWindowActions();
        testLogger();
      }

  </script>
  </head>
  <body class="iframe-font test-panel-container">
    <div class="test-panel plugin-test-panel">    
      <div class="bottom-10">
        <span class="bigger-bold-text">Plug-in Request Test</span>
        <!-- Tests the sending of requests to other plugins. Defaults to send a message
             to itself (and responding) to show more parts of the API-->
        <button class="iframe-button shadowed" type="button" onclick="sendAppRequest()">Send App Request</button>
        <button class="iframe-button shadowed" type="button" onclick="getDefaultsFromServer()">Get from Server</button>
        <button class="iframe-button shadowed" type="button" onclick="saveToServer()">Save to Server</button>
        <button class="iframe-button shadowed" type="button" onclick="ZoweZLUX.notificationManager.createNotification('bird', 'up', 1, 't.e.s.t').then(res => ZoweZLUX.notificationManager.notify(res))">Send notification</button>
        <button class="iframe-button shadowed" type="button" onclick="test();">Run Unit Test</button>
        <button class="iframe-button shadowed" type="button" onclick="windowActions.minimize();">Minimize</button>
        <button class="iframe-button shadowed" type="button" onclick="windowActions.maximize();">Maximize</button>
        <button class="iframe-button shadowed" type="button" onclick="windowActions.close();">Close</button>
        <button class="iframe-button shadowed" type="button" onclick="getLaunchMetadata().then((res) => console.log(res))">Log launch metadata</button>
      </div>
      <span class="bold-text">Application Identifier: </span>
      <div>
        <div class="div-input">
          <input class="iframe-input input-height input-corner input-text shadowed" type="text" name="appId" id="appId" placeholder="app identifier" value="org.zowe.terminal.tn3270"/>
        </div>
        <div>
          <!-- Action types are used to determine what sort of Action is being taken on whatever App instance is the target. Launch simply creates a new instance with the context you provide, but Message can be used to communicate with an already open Instance to drive some action -->
          <label class="bold-text">Action Type: </label>
          <input type="radio" id="actionLaunch"
                 name="actionType" value="Launch" checked>
          <label for="actionLaunch">Launch</label>

          <input type="radio" id="actionMessage"
                 name="actionType" value="Message">
          <label for="actionMessage">Message</label>
        </div>
        <!-- App target modes are used to determine which instance of an App should be communicated with. You can create a new instance to send the Action to, or you could reuse an existing instance that is open. -->
        <div>
          <label class="bold-text">App Target Mode: </label>
          <input type="radio" id="targetCreate"
                 name="targetMode" value="PluginCreate" checked>
          <label for="targetCreate">Create New</label>

          <input type="radio" id="targetReuse"
                 name="targetMode" value="PluginFindAnyOrCreate">
          <label for="targetReuse">Reuse Any Open</label>
        </div>      
        <span class="bold-text hide-it">Target App Window Title (this will become the title for the target window)</span>
        <div class="div-input hide-it">
          <input class="iframe-input input-height input-corner input-text shadowed" type="text" name="appWindowTitle" id="appWindowTitle" placeholder="app window title" value="My New Title"/>
        </div>
        <span class="div-input bold-text">Parameters:</span>
        <div class="div-textarea-input">
          <!-- The text here is merely an example which provides some connection details for the terminal app. It could be anything so long as the receiving App supports it.
               In this example App, the contents here will be put inside of a JSON with the contents as the "data" attribute. -->
          <textarea class="iframe-input input-corner input-text shadowed" rows="11" cols="50" name="parameters" id="parameters">
{"type":"connect",
 "connectionSettings":{
   "host":"localhost",
   "port":23,
   "deviceType":5,
   "alternateHeight":60,
   "alternateWidth":132,
   "oiaEnabled": true,
   "security": {
     "type":0
   }
}}</textarea>
        </div>
        <div style="width: 100%">
          <span>App Status or Message:</span>
          <p class="display-text shadowed disable-effect" id="status">Status will appear here.</p>
        </div>
      </div>
    </div>
    <div class="test-panel dataservice-test-panel">
      <div class="bottom-10">
        <span class="bigger-bold-text">Dataservice Request Test</span>
      </div>
      <div>
        <input placeholder="Message" name="helloText" id="helloText" oninput="inputChanged()"/>
        <button id="runButton" onclick="sayHello()" disabled>Run</button>
      </div>
      <div>
        <label>Response</label>
        <textarea readonly class="server-response" placeholder="Response" name="serverResponseMessage" id="serverResponseMessage"></textarea>
      </div>
    </div>    
  </body>
</html>


<!-- 
  This program and the accompanying materials are
  made available under the terms of the Eclipse Public License v2.0 which accompanies
  this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html
  
  SPDX-License-Identifier: EPL-2.0
  
  Copyright Contributors to the Zowe Project.
-->

